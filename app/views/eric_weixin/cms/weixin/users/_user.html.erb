<%= debug(params) if Rails.env.development? %><br><br>

<% if @user.count == 0 %>
  <%= '查询不到你要的信息' %>
<% else %>
  <table>
    <thead>
    <tr>
      <th>
        用户编号
      </th>
      <th>
        昵称
      </th>
      <th>
        头像
      </th>
      <th>
        订阅情况
      </th>
      <th>
        性别
      </th>
      <th>
        语言
      </th>
      <th>
        位置
      </th>
      <th>
        备注
      </th>
      <th>
        所属公众号
      </th>
      <th>
        初始注册频道
      </th>
      <th>
        最后注册频道
      </th>
      <th>
        创建于
      </th>
      <th>
        更新于
      </th>
      <th>
        操作
      </th>
    </tr>
    </thead>
    <% @user.each do |user| %>
      <tbody>
        <tr>
          <td>
            <%= user.id %>
          </td>
          <td>
            <%= user.nickname %>
          </td>
          <td>
            <img src="<%= user.headimgurl %>"/>
          </td>
          <td>
            <%= user.subscribe == 1 ? "订阅于#{user.subscribe_time}" : "未订阅" %>
          </td>
          <td>
            <%= user.sex == 1 ? "男" : "女" %>
          </td>
          <td>
            <%= user.language %>
          </td>
          <td>
            <%= user.country %>~<%= user.province %>~<%= user.city %>
          </td>
          <td id="user_remark_<%= user.id %>">
            <%= user.remark %>
          </td>
          <td>
            <%= user.weixin_public_account_id %>
          </td>
          <td>
            <%= user.first_register_channel %>
          </td>
          <td>
            <%= user.last_register_channel %>
          </td>
          <td>
            <%= user.created_at.chinese_format %>
          </td>
          <td>
            <%= user.updated_at.chinese_format %>
          </td>
          <td>
            <%= link_to '修改备注名', "javascript:open_modal(#{user.id})" %>
          </td>
        </tr>
      </tbody>
    <% end %>
  </table>
<% end %>

<%= will_paginate @user %>


<%= hidden_field_tag :hidden_user_id %>
<script language="javascript">
    function open_modal(user_id){
      $("#hidden_user_id").val(user_id);
      $('#myModal').foundation('reveal', 'open');

    }
    function modify_remark(){
        user_id = $("#hidden_user_id").val();
        new_remark = $("#new_remark").val();
        $.ajax({
            url: "/eric_weixin/cms/weixin/users/"+user_id+"/modify_remark",
            type: "post",
            async: false,
            data: {new_remark: new_remark}
        }).done(
            function(result){
              alert(result);
                $("#user_remark_"+user_id).html(result);
                $('#myModal').foundation('reveal', 'close');
            }
        );
        openWindow();
    }
</script>



<div id="myModal" class="reveal-modal" data-reveal aria-labelledby="modalTitle" aria-hidden="true" role="dialog">
  
    <label class="inline left">新备注</label>
    <%= text_field_tag :new_remark %>
    <%= link_to "提交", "javascript:modify_remark()" %>
    
    
  <a class="close-reveal-modal" aria-label="Close">&#215;</a>
</div>
